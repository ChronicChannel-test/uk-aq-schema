-- Seed curated connectors (run after uk_aq_core_schema.sql).
-- Safe to rerun; upserts by connector_code.

insert into uk_aq_core.connectors (
  id,
  connector_code,
  label,
  display_name,
  service_url,
  station_display_name_template,
  overwrite_station_name,
  poll_enabled,
  poll_interval_minutes,
  poll_window_hours,
  poll_timeseries_batch_size,
  stations_bbox_supported,
  timeseries_station_filter_supported,
  last_polled_at,
  last_run_start,
  last_run_end,
  last_run_status,
  last_run_message,
  created_at
)
values
(
  1,
  'uk_air_sos',
  'UK-AIR-SOS',
  'UK-AIR-SOS',
  'https://uk-air.defra.gov.uk/sos-ukair/api/v1',
  '{station_name}',
  true,
  false,
  10,
  6,
  400,
  false,
  false,
  '2026-02-07 20:55:21.057+00',
  '2026-02-07 20:54:30.907+00',
  '2026-02-07 20:55:21.057+00',
  'succeeded',
  'dispatched',
  '2026-01-26 22:56:04.289763+00'
),
(
  2,
  'breathelondon',
  'Breathe London',
  'Breathe London',
  'https://api.breathelondon-communities.org/api',
  '{station_name}',
  true,
  false,
  2,
  6,
  100,
  false,
  false,
  '2026-02-08 13:14:21.763+00',
  '2026-02-08 13:12:28.313+00',
  '2026-02-08 13:14:21.763+00',
  'succeeded',
  'dispatched',
  '2026-01-26 22:56:21.488325+00'
),
(
  3,
  'erg_laqn',
  'ERG London Air',
  'London Air LAQN',
  'https://api.erg.ic.ac.uk/AirQuality',
  '{station_name}',
  true,
  false,
  10,
  6,
  100,
  false,
  false,
  '2026-02-06 00:05:02.052+00',
  '2026-02-06 00:02:58.436+00',
  '2026-02-06 00:05:02.052+00',
  'succeeded',
  'dispatched',
  '2026-01-26 22:56:28.292953+00'
),
(
  7,
  'sensorcommunity',
  'Sensor.Community',
  'Sensor.Community',
  'https://data.sensor.community',
  null,
  false,
  false,
  5,
  6,
  500,
  false,
  false,
  '2026-02-07 20:57:43.385+00',
  '2026-02-07 20:57:30.998+00',
  '2026-02-07 20:57:43.385+00',
  'succeeded',
  'dispatched',
  '2026-01-27 00:47:49.733653+00'
),
(
  306,
  'openaq',
  'OpenAQ',
  'OpenAQ',
  'https://api.openaq.org/v3',
  '{station_name}',
  true,
  false,
  1,
  12,
  56,
  false,
  false,
  '2026-02-07 20:59:53.231+00',
  '2026-02-07 20:59:42.827+00',
  '2026-02-07 20:59:53.231+00',
  'succeeded',
  'dispatched',
  '2026-01-29 11:47:44.833274+00'
)
on conflict (connector_code) do update
set label = excluded.label,
    display_name = excluded.display_name,
    service_url = excluded.service_url,
    station_display_name_template = excluded.station_display_name_template,
    overwrite_station_name = excluded.overwrite_station_name,
    poll_enabled = excluded.poll_enabled,
    poll_interval_minutes = excluded.poll_interval_minutes,
    poll_window_hours = excluded.poll_window_hours,
    poll_timeseries_batch_size = excluded.poll_timeseries_batch_size,
    stations_bbox_supported = excluded.stations_bbox_supported,
    timeseries_station_filter_supported = excluded.timeseries_station_filter_supported,
    last_polled_at = excluded.last_polled_at,
    last_run_start = excluded.last_run_start,
    last_run_end = excluded.last_run_end,
    last_run_status = excluded.last_run_status,
    last_run_message = excluded.last_run_message,
    created_at = excluded.created_at;

-- Keep identity in sync when explicit IDs are seeded.
select setval(
  pg_get_serial_sequence('uk_aq_core.connectors', 'id'),
  (select coalesce(max(id), 1) from uk_aq_core.connectors),
  true
);
